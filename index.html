<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Covoiturage U15 - Basket</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        /* Styles inchangés */
    </style>
</head>
<body>
    <h1>Covoiturage U15</h1>
    
    <div id="dateDisplay"></div>

    <div class="section">
        <h2>Ajouter un joueur</h2>
        <form id="joueurForm">
            <input type="text" id="nomJoueur" placeholder="Nom du joueur" required>
            <button type="submit">Ajouter un joueur</button>
        </form>
        <div id="joueursList"></div>
    </div>

    <div class="section">
        <h2>Ajouter un covoiturage</h2>
        <form id="covoiturageForm">
            <input type="text" id="nom" placeholder="Nom du conducteur" required>
            <input type="number" id="places" placeholder="Nombre de places disponibles" required min="1">
            <div class="trajet-options">
                <label><input type="checkbox" id="aller" name="trajet" value="aller" onchange="toggleJoueurSelection('aller')"> Aller</label>
                <label><input type="checkbox" id="retour" name="trajet" value="retour" onchange="toggleJoueurSelection('retour')"> Retour</label>
            </div>
            <div id="joueursSelectAller" class="joueurs-trajet" style="display: none;">
                <h3>Joueurs pour l'aller :</h3>
            </div>
            <div id="joueursSelectRetour" class="joueurs-trajet" style="display: none;">
                <h3>Joueurs pour le retour :</h3>
            </div>
            <button type="submit">Ajouter un covoiturage</button>
        </form>
        <div id="covoiturageList"></div>
    </div>

    <div id="debugInfo"></div>

    <script>
        // Configuration de Firebase (à remplacer par vos propres informations)
        const firebaseConfig = {
              apiKey: "AIzaSyBfr0A4LZbuFc8D8MI0wL_nfzO3Atbcqwk",
              authDomain: "covoiturage-u15.firebaseapp.com",
              databaseURL: "https://covoiturage-u15-default-rtdb.firebaseio.com",
              projectId: "covoiturage-u15",
              storageBucket: "covoiturage-u15.appspot.com",
              messagingSenderId: "83669001760",
              appId: "1:83669001760:web:b0d65f3832344dd928be45"
        };

        // Fonction pour afficher la date actuelle
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = now.toLocaleDateString('fr-FR', options);
        }

        // Fonction de débogage améliorée
        function debugLog(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML += `<p class="${type}">[${type.toUpperCase()}] ${message}</p>`;
        }

        // Initialisation de Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            debugLog("Firebase initialisé avec succès");
        } catch (error) {
            debugLog(`Erreur lors de l'initialisation de Firebase: ${error.message}`, 'error');
        }

        const covoiturageRef = database.ref('covoiturage');
        const joueursRef = database.ref('joueurs');

        function toggleJoueurSelection(trajet) {
            const isChecked = document.getElementById(trajet).checked;
            document.getElementById(`joueursSelect${trajet.charAt(0).toUpperCase() + trajet.slice(1)}`).style.display = isChecked ? 'block' : 'none';
        }

        // Fonction pour ajouter un covoiturage
        document.getElementById('covoiturageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            debugLog("Tentative d'ajout d'un covoiturage");
            const nom = document.getElementById('nom').value;
            const places = document.getElementById('places').value;
            const date = new Date().toISOString();
            const aller = document.getElementById('aller').checked;
            const retour = document.getElementById('retour').checked;
            const joueursAller = Array.from(document.querySelectorAll('#joueursSelectAller .joueur-select:checked')).map(el => el.value);
            const joueursRetour = Array.from(document.querySelectorAll('#joueursSelectRetour .joueur-select:checked')).map(el => el.value);

            if (!aller && !retour) {
                debugLog("Erreur : Aucun trajet sélectionné", 'error');
                alert("Veuillez sélectionner au moins un trajet (aller et/ou retour)");
                return;
            }

            covoiturageRef.push({
                nom: nom,
                date: date,
                places: places,
                aller: aller,
                retour: retour,
                joueursAller: joueursAller,
                joueursRetour: joueursRetour
            }).then(() => {
                debugLog(`Covoiturage ajouté: ${nom}`);
                this.reset();
                document.getElementById('joueursSelectAller').style.display = 'none';
                document.getElementById('joueursSelectRetour').style.display = 'none';
                updateJoueurSelect();
            }).catch((error) => {
                debugLog(`Erreur lors de l'ajout du covoiturage: ${error.message}`, 'error');
            });
        });

        // Fonction pour ajouter un joueur
        document.getElementById('joueurForm').addEventListener('submit', function(e) {
            e.preventDefault();
            debugLog("Tentative d'ajout d'un joueur");
            const nom = document.getElementById('nomJoueur').value;

            joueursRef.push({
                nom: nom
            }).then(() => {
                debugLog(`Joueur ajouté: ${nom}`);
                this.reset();
                updateJoueurSelect();
            }).catch((error) => {
                debugLog(`Erreur lors de l'ajout du joueur: ${error.message}`, 'error');
            });
        });

        // Fonction pour supprimer un joueur
        function supprimerJoueur(joueurId) {
            debugLog(`Tentative de suppression du joueur: ${joueurId}`);
            joueursRef.child(joueurId).remove()
                .then(() => {
                    debugLog(`Joueur supprimé: ${joueurId}`);
                    updateJoueurSelect();
                })
                .catch((error) => {
                    debugLog(`Erreur lors de la suppression du joueur: ${error.message}`, 'error');
                });

            // Le reste de la fonction reste inchangé
        }

        // Fonction pour supprimer un covoiturage
        function supprimerCovoiturage(covoiturageId) {
            debugLog(`Tentative de suppression du covoiturage: ${covoiturageId}`);
            covoiturageRef.child(covoiturageId).remove()
                .then(() => {
                    debugLog(`Covoiturage supprimé: ${covoiturageId}`);
                })
                .catch((error) => {
                    debugLog(`Erreur lors de la suppression du covoiturage: ${error.message}`, 'error');
                });
        }

        // Fonction pour mettre à jour la sélection des joueurs
        function updateJoueurSelect() {
            debugLog("Mise à jour de la sélection des joueurs");
            // Le reste de la fonction reste inchangé
        }

        // Fonction pour afficher les covoiturages
        covoiturageRef.on('value', function(snapshot) {
            debugLog("Mise à jour de la liste des covoiturages");
            // Le reste de la fonction reste inchangé
        }, function(error) {
            debugLog(`Erreur lors de la récupération des covoiturages: ${error.message}`, 'error');
        });

        // Fonction pour afficher les joueurs
        joueursRef.on('value', function(snapshot) {
            debugLog("Mise à jour de la liste des joueurs");
            // Le reste de la fonction reste inchangé
        }, function(error) {
            debugLog(`Erreur lors de la récupération des joueurs: ${error.message}`, 'error');
        });

        // Mettre à jour la date au chargement de la page
        updateDate();
        // Mettre à jour la date toutes les minutes
        setInterval(updateDate, 60000);
    </script>
</body>
</html>
