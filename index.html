<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Covoiturage Basket U15</title>
    <style>
        /* Vos styles CSS existants */
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <!-- Votre HTML existant -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configuration Firebase
            const firebaseConfig = {
                // Remplacez ces valeurs par celles de votre projet Firebase
                apiKey: "AIzaSyBfr0A4LZbuFc8D8MI0wL_nfzO3Atbcqwk",
  authDomain: "covoiturage-u15.firebaseapp.com",
  databaseURL: "https://covoiturage-u15-default-rtdb.firebaseio.com",
  projectId: "covoiturage-u15",
  storageBucket: "covoiturage-u15.appspot.com",
  messagingSenderId: "83669001760",
  appId: "1:83669001760:web:b0d65f3832344dd928be45"
            };

            // Initialiser Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            let joueurs = [];
            let conducteurs = [];

            // Initialiser la date du jour pour le calendrier
            document.getElementById('dateMatch').valueAsDate = new Date();

            function sauvegarderDonnees() {
                database.ref('covoiturage').set({
                    joueurs: joueurs,
                    conducteurs: conducteurs
                });
            }

            function chargerDonnees() {
                database.ref('covoiturage').once('value').then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        joueurs = data.joueurs || [];
                        conducteurs = data.conducteurs || [];
                        mettreAJourListeJoueurs();
                        mettreAJourListeConducteurs();
                        mettreAJourSelectJoueurs();
                        mettreAJourSelectConducteurs();
                        afficherAssignations();
                    }
                });
            }

            window.ajouterJoueur = function() {
                const nom = document.getElementById('nomJoueur').value;
                if (nom) {
                    joueurs.push({ nom, assigneAller: false, assigneRetour: false });
                    mettreAJourListeJoueurs();
                    mettreAJourSelectJoueurs();
                    document.getElementById('nomJoueur').value = '';
                    sauvegarderDonnees();
                }
            }

            window.ajouterConducteur = function() {
                const nom = document.getElementById('nomConducteur').value;
                const trajet = document.getElementById('trajetConducteur').value;
                const places = parseInt(document.getElementById('placesVoiture').value);
                if (nom && places > 0) {
                    conducteurs.push({ nom, trajet, places, passagersAller: [], passagersRetour: [] });
                    mettreAJourListeConducteurs();
                    mettreAJourSelectConducteurs();
                    document.getElementById('nomConducteur').value = '';
                    document.getElementById('placesVoiture').value = '4';
                    sauvegarderDonnees();
                }
            }

            function mettreAJourListeJoueurs() {
                const liste = document.getElementById('listeJoueurs');
                liste.innerHTML = '';
                joueurs.forEach((joueur, index) => {
                    const button = document.createElement('button');
                    button.innerHTML = `
                        ${joueur.nom}
                        <span>
                            <button class="delete-btn" onclick="supprimerJoueur(${index})">Supprimer</button>
                        </span>
                    `;
                    liste.appendChild(button);
                });
            }

            function mettreAJourListeConducteurs() {
                const liste = document.getElementById('listeConducteurs');
                liste.innerHTML = '';
                conducteurs.forEach((conducteur, index) => {
                    const button = document.createElement('button');
                    button.innerHTML = `
                        ${conducteur.nom} (${conducteur.trajet}, ${conducteur.places} places)
                        <span>
                            <button class="delete-btn" onclick="supprimerConducteur(${index})">Supprimer</button>
                        </span>
                    `;
                    liste.appendChild(button);
                });
            }

            window.supprimerJoueur = function(index) {
                joueurs.splice(index, 1);
                mettreAJourListeJoueurs();
                mettreAJourSelectJoueurs();
                conducteurs.forEach(conducteur => {
                    conducteur.passagersAller = conducteur.passagersAller.filter(j => j !== joueurs[index]);
                    conducteur.passagersRetour = conducteur.passagersRetour.filter(j => j !== joueurs[index]);
                });
                afficherAssignations();
                sauvegarderDonnees();
            }

            window.supprimerConducteur = function(index) {
                conducteurs.splice(index, 1);
                mettreAJourListeConducteurs();
                mettreAJourSelectConducteurs();
                afficherAssignations();
                sauvegarderDonnees();
            }

            function mettreAJourSelectJoueurs() {
                const select = document.getElementById('joueurAssign');
                const trajetSelect = document.getElementById('trajetAssign');
                const trajetSelectionne = trajetSelect.value;
                
                select.innerHTML = '<option value="">Sélectionner un joueur</option>';
                joueurs.forEach((joueur, index) => {
                    if ((trajetSelectionne === 'aller' && !joueur.assigneAller) ||
                        (trajetSelectionne === 'retour' && !joueur.assigneRetour) ||
                        (trajetSelectionne === 'aller-retour' && (!joueur.assigneAller || !joueur.assigneRetour))) {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = joueur.nom;
                        select.appendChild(option);
                    }
                });
            }

            function mettreAJourSelectConducteurs() {
                const select = document.getElementById('conducteurAssign');
                select.innerHTML = '<option value="">Sélectionner un conducteur</option>';
                conducteurs.forEach((conducteur, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${conducteur.nom} (${conducteur.trajet}, ${conducteur.places} places)`;
                    select.appendChild(option);
                });
            }

            window.mettreAJourOptionsTrajet = function() {
                const conducteurSelect = document.getElementById('conducteurAssign');
                const trajetSelect = document.getElementById('trajetAssign');
                const conducteurIndex = conducteurSelect.value;

                trajetSelect.innerHTML = '<option value="">Sélectionner un trajet</option>';

                if (conducteurIndex !== '') {
                    const conducteur = conducteurs[conducteurIndex];
                    if (conducteur.trajet === 'aller' || conducteur.trajet === 'aller-retour') {
                        trajetSelect.innerHTML += '<option value="aller">Aller</option>';
                    }
                    if (conducteur.trajet === 'retour' || conducteur.trajet === 'aller-retour') {
                        trajetSelect.innerHTML += '<option value="retour">Retour</option>';
                    }
                    if (conducteur.trajet === 'aller-retour') {
                        trajetSelect.innerHTML += '<option value="aller-retour">Aller-Retour</option>';
                    }
                }

                mettreAJourSelectJoueurs();
            }

            window.assignerJoueur = function() {
                const joueurIndex = document.getElementById('joueurAssign').value;
                const trajet = document.getElementById('trajetAssign').value;
                const conducteurIndex = document.getElementById('conducteurAssign').value;
                
                if (joueurIndex !== '' && conducteurIndex !== '' && trajet !== '') {
                    const joueur = joueurs[joueurIndex];
                    const conducteur = conducteurs[conducteurIndex];
                    
                    if ((trajet === 'aller' || trajet === 'aller-retour') && conducteur.trajet !== 'retour') {
                        if (conducteur.passagersAller.length < conducteur.places && !joueur.assigneAller) {
                            conducteur.passagersAller.push(joueur);
                            joueur.assigneAller = true;
                        } else {
                            alert("Pas de place disponible pour l'aller ou joueur déjà assigné.");
                            return;
                        }
                    }
                    if ((trajet === 'retour' || trajet === 'aller-retour') && conducteur.trajet !== 'aller') {
                        if (conducteur.passagersRetour.length < conducteur.places && !joueur.assigneRetour) {
                            conducteur.passagersRetour.push(joueur);
                            joueur.assigneRetour = true;
                        } else {
                            alert("Pas de place disponible pour le retour ou joueur déjà assigné.");
                            return;
                        }
                    }
                    
                    mettreAJourListeJoueurs();
                    mettreAJourSelectJoueurs();
                    afficherAssignations();
                    sauvegarderDonnees();
                } else {
                    alert("Veuillez sélectionner un conducteur, un trajet et un joueur.");
                }
            }

            function afficherAssignations() {
                const div = document.getElementById('assignations');
                div.innerHTML = '<h2>Assignations actuelles</h2>';
                
                conducteurs.forEach(conducteur => {
                    const conducteurDiv = document.createElement('div');
                    conducteurDiv.className = 'conducteur';
                    conducteurDiv.innerHTML = `<h3>${conducteur.nom} - ${conducteur.trajet} (${conducteur.places} places)</h3>`;
                    
                    const passagersDiv = document.createElement('div');
                    passagersDiv.className = 'passagers';
                    const tousPassagers = [...new Set([...conducteur.passagersAller, ...conducteur.passagersRetour])];
                    passagersDiv.innerHTML = `<strong>Passagers (${tousPassagers.length}/${conducteur.places}):</strong> `;
                    passagersDiv.innerHTML += tousPassagers.map(joueur => joueur.nom).join(', ') || 'Aucun';
                    conducteurDiv.appendChild(passagersDiv);
                    
                    div.appendChild(conducteurDiv);
                });
            }

            // Ajouter des écouteurs d'événements pour mettre à jour la liste des joueurs disponibles
            document.getElementById('trajetAssign').addEventListener('change', mettreAJourSelectJoueurs);
            document.getElementById('conducteurAssign').addEventListener('change', mettreAJourSelectJoueurs);

            // Initialisation
            chargerDonnees();
        });
    </script>
</body>
</html>
